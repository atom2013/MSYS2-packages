From 8f25ab7c62e5280c059a6e451017aa1f888dd1d7 Mon Sep 17 00:00:00 2001
From: "atom.long" <atom.long@hotmail.com>
Date: Fri, 22 Jun 2018 12:15:21 +0800
Subject: [PATCH] fixed building git-credential-wincred on cygwin 2.5.2

---
 contrib/credential/wincred/Makefile                 | 2 +-
 contrib/credential/wincred/git-credential-wincred.c | 5 +++--
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/contrib/credential/wincred/Makefile b/contrib/credential/wincred/Makefile
index 6e992c0866..61b57923a1 100644
--- a/contrib/credential/wincred/Makefile
+++ b/contrib/credential/wincred/Makefile
@@ -16,7 +16,7 @@ git-credential-wincred.exe : git-credential-wincred.c
 	$(LINK.c) $^ $(LOADLIBES) $(LDLIBS) -o $@
 
 install: git-credential-wincred.exe
-	$(INSTALL) -m 755 $^ $(libexecdir)
+	$(INSTALL) -m 755 $^ $(DESTDIR)$(libexecdir)
 
 clean:
 	$(RM) git-credential-wincred.exe
diff --git a/contrib/credential/wincred/git-credential-wincred.c b/contrib/credential/wincred/git-credential-wincred.c
index 5bdad41de1..372d2c794a 100644
--- a/contrib/credential/wincred/git-credential-wincred.c
+++ b/contrib/credential/wincred/git-credential-wincred.c
@@ -6,6 +6,7 @@
 #include <stdio.h>
 #include <io.h>
 #include <fcntl.h>
+#include <wchar.h>
 
 /* common helpers */
 
@@ -291,8 +292,8 @@ int main(int argc, char *argv[])
 		die(usage);
 
 	/* git use binary pipes to avoid CRLF-issues */
-	_setmode(_fileno(stdin), _O_BINARY);
-	_setmode(_fileno(stdout), _O_BINARY);
+	_setmode(fileno(stdin), O_BINARY);
+	_setmode(fileno(stdout), O_BINARY);
 
 	read_credential();
 
-- 
2.17.1

